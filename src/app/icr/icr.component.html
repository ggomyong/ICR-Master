<div class="main-search-form">
  <form style="width: 100%;">
    <mat-form-field id="dropdown-field">
      <mat-select required [(ngModel)]="displayField" [ngModelOptions]="{standalone: true}">
        <mat-option *ngFor="let field of fieldList" [value]="field.value">{{field.external}}</mat-option>
      </mat-select>
      <mat-label>ICR Field</mat-label>
    </mat-form-field>

    <mat-form-field id="query-string">
        <mat-label>Filter by...</mat-label>
        <input matInput [(ngModel)]="displayQuery" [ngModelOptions]="{standalone: true}" (keydown)="onKeydown($event)">
        <button type="button" mat-button *ngIf="displayQuery" matSuffix mat-icon-button aria-label="Clear" (click)="resetQuery()">
          <mat-icon>close</mat-icon>
        </button>
    </mat-form-field>

    <mat-radio-group name="displayFilter" [(ngModel)]="displayFilter" [ngModelOptions]="{standalone: true}" id="display-filter" aria-label="Select an option">
      <mat-radio-button class="radio-option" value="B" checked (change)="filterChange($event)">All&nbsp;</mat-radio-button>
      <mat-radio-button class="radio-option" value="G" (change)="filterChange($event)">Global&nbsp;</mat-radio-button>
      <mat-radio-button class="radio-option" value="R" (change)="filterChange($event)">Routine&nbsp;</mat-radio-button>
    </mat-radio-group>
  </form>
</div>

<mat-paginator #paginator [length]="pageLength"
               [pageSize]="pageSize"
               [pageSizeOptions]="pageSizeOptions"
               (page)="pageEvent = onPageChanged($event)">
</mat-paginator>

<mat-grid-list cols="3">
  <mat-grid-tile *ngFor="let icr of pageIcrs" >
    <mat-card class="icr-card" style="margin-top:10px;">
      <mat-card-header>
        <mat-icon *ngIf="icr.validated" mat-card-avatar>done_outline</mat-icon>
        <mat-icon *ngIf="!icr.validated" mat-card-avatar>warning</mat-icon>
        <mat-card-title>
          {{icr.id}}&nbsp;-&nbsp;{{icr.value}}
          <span *ngIf="icr.type==='G'">
            &nbsp;(File #{{icr.file}})
          </span>
        </mat-card-title>
        <mat-card-subtitle>
        {{icr.name}}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <div class="icr-description">
          <b>Description</b>
          <p *ngFor="let description of icr.description">
            {{description}}
          </p>
        </div>
        <div class="icr-components">
          <b *ngIf="icr.type==='G'">Fields</b>
          <table *ngIf="icr.fields.length>0" mat-table [dataSource]="icr.fields" class="mat-elevation-z8">
            <!-- Position Column -->
            <ng-container matColumnDef="file">
              <th mat-header-cell *matHeaderCellDef> File </th>
              <td mat-cell *matCellDef="let element"> {{element.file}} </td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="value">
              <th mat-header-cell *matHeaderCellDef> Field/Index </th>
              <td mat-cell *matCellDef="let element"> {{element.value}} </td>
            </ng-container>

            <!-- Weight Column -->
            <ng-container matColumnDef="direction">
              <th mat-header-cell *matHeaderCellDef> Direction </th>
              <td mat-cell *matCellDef="let element"> {{element.direction}} </td>
            </ng-container>

            <!-- Symbol Column -->
            <ng-container matColumnDef="method">
              <th mat-header-cell *matHeaderCellDef> Method </th>
              <td mat-cell *matCellDef="let element"> {{element.method}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
          <div *ngIf="icr.tags.length>0">
            <b *ngIf="icr.type==='R'">Tags</b>
            <div *ngFor="let tag of icr.tags">
              {{tag}}
            </div>
          </div>

        </div>
      </mat-card-content>
      <mat-card-actions style="text-align: right;">
        <button mat-raised-button (click)="onEditDialog(icr)">View/Edit</button>
        <button *ngIf="!icr.validated" (click)="onValidate(icr,true)" mat-raised-button>Validate</button>
        <button *ngIf="icr.validated" (click)="onValidate(icr,false)" mat-raised-button>Unvalidate</button>
      </mat-card-actions>
    </mat-card>
  </mat-grid-tile>
</mat-grid-list>

<mat-paginator #paginator [length]="pageLength"
               [pageSize]="pageSize"
               [pageSizeOptions]="pageSizeOptions"
               (page)="pageEvent = onPageChanged($event)">
</mat-paginator>
